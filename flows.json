[{"id":"23c67a44370c4795","type":"tab","label":"PCMR Team 2D Vision","disabled":false,"info":"","env":[]},{"id":"3d414bb96a79546c","type":"Start Robot Flow","z":"23c67a44370c4795","name":"CV2D","robot":"1fa10decd9e2020a","x":90,"y":160,"wires":[["f24ed685c0d396ab"]]},{"id":"c0a11461626e0c11","type":"End Robot Flow","z":"23c67a44370c4795","x":570,"y":160,"wires":[[]]},{"id":"f24ed685c0d396ab","type":"Movement","z":"23c67a44370c4795","name":"Move to init pos","approachVelocity":"50","approachAcceleration":"50","robot":"1fa10decd9e2020a","sequence":[{"type":"cartValues","name":"Ref Point","approachMode":2,"jointAngles":[],"cartValues":[-600,-300,600,-135,0,180]}],"x":260,"y":160,"wires":[["7c1e5d7926e255af"]]},{"id":"79befd9edfa6f90f","type":"Movement","z":"23c67a44370c4795","name":"Move above Box","approachVelocity":"50","approachAcceleration":"50","robot":"1fa10decd9e2020a","sequence":[{"type":"cartValues","name":"Position 2","approachMode":2,"jointAngles":[],"cartValues":[-870,150,300,-135,0,180]}],"x":770,"y":160,"wires":[["a9fd49a62655a208","4f9fdc559aaaf411"]]},{"id":"64d0530be9dff6fc","type":"http request","z":"23c67a44370c4795","name":"Get Obj 3D points","method":"GET","ret":"obj","paytoqs":"ignore","url":"http://10.10.181.94:5000/","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":710,"y":300,"wires":[["33c44765ba9a369d"]]},{"id":"33c44765ba9a369d","type":"debug","z":"23c67a44370c4795","name":"","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":940,"y":300,"wires":[]},{"id":"06e534542b4cf665","type":"inject","z":"23c67a44370c4795","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":420,"y":300,"wires":[["64d0530be9dff6fc"]]},{"id":"7c1e5d7926e255af","type":"function","z":"23c67a44370c4795","name":"CV2D","func":"// var httpResp = msg.payload;\n//                          [-600, -300, 600, -135, 0, 180],\n//                         [-690, -132, 70, -135, 0, 180],\n//                         [-600, -300, 600, -135, 0, 180],\n//                         [-641, -380, 70, -135, 0, 180],\n\nvar httpResp = {\n    \"Coordinates\": [\n        [-671, -233, 600],\n        [-764, -210, 600],\n        [-741, -295, 600]\n    ]\n}\n\nlet cords3D = httpResp.Coordinates\nnode.warn(cords3D)\nvar calibrated_orientation = [-135, 0, 180]\nvar calibrated_pos = [-600, -300, 600, -135, 0, 180]\nvar box_center_pos = [-870, 150, 300, -135, 0, 180]\nvar release_obj_pos = [-870, 150, 100, -135, 0, 180]\n\n// Translate the robot the calculated 3d positions\n\nconst robot = msg.robot;\n\nasync function pick_and_place(coordinate){\n    coordinate[2] = 70\n    coordinate = coordinate.concat(calibrated_orientation)\n    node.warn(coordinate)\n    // Move to pick the obj\n    await robot.setPose(coordinate, 2, 200, 200, {});\n    // Initiate suction\n    await robot.setOutput(4, 1);\n    // Lift the part\n    var table_center_pos = coordinate\n    table_center_pos[2] = 100\n    await robot.setPose(table_center_pos, 2, 200, 200, {});\n    // Move to box position\n    await robot.setPose(box_center_pos, 2, 200, 200, {});\n    // Stop suction\n    await robot.setOutput(4, 0);\n    // Move to release position\n    await robot.setPose(release_obj_pos, 2, 200, 200, {});\n    // Move to box position\n    await robot.setPose(box_center_pos, 2, 200, 200, {});\n    // Move to init pos\n    await robot.setPose(calibrated_pos, 2, 200, 200, {});\n};\n\nasync function cv2d(){\n    node.warn(\"----------------  Moving  Start -------------\");\n    var i;\n    for(i = 0; i < cords3D.length; i++){\n        await pick_and_place(cords3D[i]).then(() => {\n            node.send(msg)\n        });\n    };\n    node.warn(\"----------------  Moving  End -------------\");\n}\n\ncv2d().then(() => {\n    node.send(msg)\n});\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":160,"wires":[["c0a11461626e0c11"]]},{"id":"a5dc5d3b87296dc7","type":"Set Output","z":"23c67a44370c4795","name":"","sequence":[{"address":4,"value":1}],"duration":"0","robot":"1fa10decd9e2020a","x":570,"y":80,"wires":[["79befd9edfa6f90f"]]},{"id":"4f9fdc559aaaf411","type":"Set Output","z":"23c67a44370c4795","name":"","sequence":[{"address":4,"value":0}],"duration":"0","robot":"1fa10decd9e2020a","x":990,"y":80,"wires":[[]]},{"id":"a9fd49a62655a208","type":"Movement","z":"23c67a44370c4795","name":"Move into Box","approachVelocity":"40","approachAcceleration":"40","robot":"1fa10decd9e2020a","sequence":[{"type":"cartValues","name":"Position 2","approachMode":2,"jointAngles":[],"cartValues":[-870,150,100,-135,0,180]}],"x":960,"y":200,"wires":[["27074559fa1a2769"]]},{"id":"27074559fa1a2769","type":"Movement","z":"23c67a44370c4795","name":"Move above Box","approachVelocity":"50","approachAcceleration":"50","robot":"1fa10decd9e2020a","sequence":[{"type":"cartValues","name":"Position 2","approachMode":2,"jointAngles":[],"cartValues":[-870,150,300,-135,0,180]}],"x":1110,"y":140,"wires":[["83a9aa1d2d4a1e6e"]]},{"id":"83a9aa1d2d4a1e6e","type":"Movement","z":"23c67a44370c4795","name":"Move to Ref Point.","approachVelocity":"50","approachAcceleration":"50","robot":"1fa10decd9e2020a","sequence":[{"type":"cartValues","name":"Ref Point","approachMode":2,"jointAngles":[],"cartValues":[-600,-300,600,-135,0,180]}],"x":1190,"y":240,"wires":[[]]},{"id":"1fa10decd9e2020a","type":"Robot","name":"Robby","manufacturer":"RobCo","adr":"localhost","targetPort":"25000","listeningPort":"25001","inputs_names":["Input 1","Input 2","Input 3","Input 4","Input 5","Input 6","Input 7","Input 8"],"outputs_names":["Output 1","Output 2","Output 3","Output 4","Output 5","Output 6","Output 7","Output 8"],"velocity":"29","acceleration":"50"}]